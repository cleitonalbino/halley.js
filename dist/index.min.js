(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("flickity"),require("pubsub.js")):"function"==typeof define&&define.amd?define(["exports","flickity","pubsub.js"],b):(a=a||self,b(a.index={},a.Flickity,a.pubsub))})(this,function(a,b,c){'use strict';function d(a,b){if(null===a||a===void 0){throw new Error("Missing player object")}if(null===b.callback||"function"!=typeof b.callback){throw new Error("Missing the callback function")}this.player=a,this.trackValues=b.trackings||["0%","25%","50%","75%","100%"],this.callback=b.callback,this.trackList=[],this.videoTimer=null,this.setupTrackList()}function e(){const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api";const b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}b=b&&b.hasOwnProperty("default")?b["default"]:b,c=c&&c.hasOwnProperty("default")?c["default"]:c;var f={init:function(a,b){function c(){document.body.style.overflow="",f.classList.add("data-out"),f.classList.remove("data-active"),g.onClose&&g.onClose()}function d(){c()}function e(){h&&h.addEventListener("click",d)}const f="string"==typeof a?document.querySelector(a):a,g=b||{},h=f.querySelector("[data-dialog-close]");return function(){e()}(),{open:function(){document.body.style.overflow="hidden",f.classList.remove("data-out"),f.classList.add("data-active"),g.onOpen&&g.onOpen()},close:c}}};d.prototype.setupTrackList=function(){for(var a=0,b=this.trackValues.length;a<b;a++)this.trackList[this.trackValues[a]]=!1},d.prototype.onVideoStateChange=function(a){switch(a){case YT.PlayerState.PLAYING:this.startVideoTimer();break;case YT.PlayerState.ENDED:this.verifyVideoTime(),this.stopVideoTimer();break;default:this.stopVideoTimer();}},d.prototype.startVideoTimer=function(){var a=this;this.videoTimer=setInterval(function(){a.verifyVideoTime()},1e3)},d.prototype.stopVideoTimer=function(){clearInterval(this.videoTimer)},d.prototype.verifyVideoTime=function(){var b,c,d,e,a=Math.round,f=0;b=this.player.getDuration(),c=a(this.player.getCurrentTime());for(var g=0,h=this.trackValues.length;g<h;g++)d=this.trackValues[g].substr(this.trackValues[g].length-1),e=this.trackValues[g].replace(/[a-z]/g,""),"p"===d?(f=a(100*c/b),f>=e&&!1===this.trackList[this.trackValues[g]]&&this.refreshTrackList(this.trackValues[g])):"s"===d&&c>=e&&!1===this.trackList[this.trackValues[g]]&&this.refreshTrackList(this.trackValues[g])},d.prototype.refreshTrackList=function(a){this.trackList[a]=!0,this.publish(a)},d.prototype.publish=function(a){this.callback&&"function"==typeof this.callback&&this.callback(a)};var g={init(a){window.onYouTubeIframeAPIReady=()=>a(),e()}},h={carousel:{init:function(a,c){function d(){new b(e,c)}const e="string"==typeof a?document.querySelector(a):a;d()},initMany:function(a,c){const d=Array.from(document.querySelectorAll(a)),e=[];(function(){d.forEach(a=>{e.push(new b(a,c))})})()}},webpDetector:{init:function(){(function(a){if(!window.createImageBitmap)return void a(!1);fetch("data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoCAAEAAQAcJaQAA3AA/v3AgAA=").then(a=>a.blob()).then(b=>{createImageBitmap(b).then(()=>{a(!0)},()=>{a(!1)})})})(a=>{a||document.body.classList.add("dont-support-webp")})}},dialog:f,dropdown:{init:function(){const a="string"==typeof selector?document.querySelector(selector):selector,b=a.querySelector("[data-dropdown-select]"),c=a.querySelector("[data-dropdown-label]");(function(){b.addEventListener("change",()=>{c.innerHTML=b.options[b.selectedIndex].innerHTML})})()}},video:{init:async function(a,b){function c(a){a.data===YT.PlayerState.PLAYING&&m.onStateChange&&m.onStateChange(),m.onTracking&&a.target.tracking.onVideoStateChange(a.data)}function e(a){const b=a;m.onPlayVideo&&m.onPlay(),m.onTracking&&(b.target.tracking=new d(b.target,{trackings:m.onTracking.trackings,callback:m.onTracking.callback}))}function f(){n=new YT.Player(o,{videoId:m.id,playerVars:m.playerVars,events:{onReady:a=>e(a),onStateChange:a=>c(a)}}),console.log(n)}function h(){m.onClose&&m.onClose(),n.stopVideo(),n.destroy(),n=null}function i(){n.playVideo()}function j(){l.innerHTML="",o=document.createElement("div"),l.appendChild(o)}function k(){j(),f(),m.automaticPlay&&i()}const l="string"==typeof a?document.querySelector(a):a,m=b||{};let n=null,o=null;return await function(){return new Promise(a=>{g.init(k),a()})}(),{istanceVideo:n,create:k,play:i,close:h}}},videoModal:{init:function(a){function b(){c.addEventListener("click",e.open)}const c="string"==typeof a.openButton?document.querySelector(a.openButton):a.openButton,d=d.init(a.video.elm,a.video.options),e=f.init(a.modal.elm,{onOpen:d.open,onClose:d.close});return function(){b()}(),{open:e.open,close:e.close}}},mediaManager:{init:function(a){function b(a){return c.publish("CHANGE_MEDIA"),a.find(b=>a<=b.value)}var d=b(window.innerWidth),e=null,f=a.sort((c,a)=>c.value-a.value);return window.addEventListener("resize",function(){clearTimeout(e),e=setTimeout(function(){d=b(window.innerWidth)},300)}),{events:a,medias:f,getMedia:function(){return d}}}}},i={};a.default={lib:h,utils:i},a.library=h,a.utilities=i,Object.defineProperty(a,"__esModule",{value:!0})});
